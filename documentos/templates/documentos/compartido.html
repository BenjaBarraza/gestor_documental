{% extends 'documentos/base.html' %}

{% block title %}Documento Compartido{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="text-center">
    <h2 class="text-success mb-3">ğŸ“„ Documento compartido</h2>
    <p class="text-muted">EstÃ¡s viendo un documento compartido pÃºblicamente.</p>
  </div>

  <div class="card shadow-sm mt-4">
    <div class="card-body text-center">
      <h5 class="card-title">{{ documento.nombre }}</h5>
      <p class="card-text">Tipo: {{ documento.archivo.name|slice:"-4:"|upper }}</p>
      <p class="card-text text-muted">TamaÃ±o: {{ documento.archivo.size|filesizeformat }}</p>

      <a href="{{ documento.archivo.url }}" class="btn btn-primary mt-2" target="_blank">ğŸ‘ï¸ Ver documento</a>
      <a href="{{ documento.archivo.url }}" class="btn btn-success mt-2" download>â¬‡ï¸ Descargar</a>
      {% if documento.fecha_expiracion %}
        <p class="text-muted">ğŸ“… Este enlace expirarÃ¡ el {{ documento.fecha_expiracion|date:"d/m/Y H:i" }}</p>
      {% endif %}
    </div>
  </div>

  <div class="mt-4 text-center">
    <a href="{% url 'documentos:home' %}" class="btn btn-secondary">ğŸ  Volver al inicio</a>
  </div>
</div>

{% if documento.fecha_expiracion %}
<script>
  const expiracion = new Date("{{ documento.fecha_expiracion|date:'Y-m-d H:i:s' }}");
  const ahora = new Date();

  const milisegundosRestantes = expiracion - ahora;

  if (milisegundosRestantes > 0) {
    setTimeout(() => {
      window.location.reload();
    }, milisegundosRestantes);
  }
</script>
{% endif %}
{% endblock %}
